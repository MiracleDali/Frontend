<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>16_Async函数</title>
    <script src="./jquery.min.js"></script>
<style>
        h1 {
            color: #bf8d21;
        }
        h2 {
            color: #c2922a;
        }
        img {
            width: 90%;
            border: 1px solid rgb(207, 157, 20);
        }
        div {
            width: 700px;
            border: 1px solid rgb(233, 214, 160);
            padding: 15px;
            background-color: rgb(255, 253, 247);
            border-radius:10px;
            margin-bottom: 15px;
        }
        code {
            font-size: large;
            border-left: #8b5e09 10px solid;
            padding-left: 10px;
        }
    </style>
</head>
<body>

    <h1>Async函数</h1>
    <div>
        <code>ES2017标准引入了 async函数，是的异步操作变得更加简单方便</code> <br>
        <code>Async函数可以将异步操作变为同步操作</code>
    </div>


    <script>

        function print(){
            // 定时器是异步的
            setTimeout(() => {
                console.log('定时器')
            },10)
            console.log('hello')
        }
        print();    // 输出的先后顺序  ->  hello 定时器


        // async函数 
        function timeout(ms){
            // resolve: 是一个函数
            return new Promise((resolve, reject) => {
                setTimeout(function(){
                    console.log('定时器');
                    resolve();
                },ms)
            })
        }
        async function asyncPrint(ms, val){
            await timeout(ms);
            console.log(val);
        }
        asyncPrint(500, 'hello');  // 输出的先后顺序  ->  定时器 hello



        // 网络请求之间，很多接口需要依赖上一个接口的数据才能执行
        function ajax(url) {
            return new Promise(function(resolve, reject) {
                $.getJSON(url, function(result) {
                    resolve(result);
                }, function(error) {
                    reject(error);
                })
            })
        }

        async function getInfo() {
            var id = await ajax("https://jsonplaceholder.typicode.com/posts/1");
            // console.log("id", id)
            var info = await ajax("https://jsonplaceholder.typicode.com/users/" +id.id);
            // console.log("info", info)
            console.log("结果", info)
        }
        getInfo();


    </script>
    
</body>
</html>

